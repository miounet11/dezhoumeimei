# Grafana监控配置
# PokerIQ Pro高性能监控平台

global:
  # 检查更新间隔
  check_for_updates: true
  check_for_plugin_updates: true

# 数据源配置
datasources:
  # Prometheus主数据源
  - name: Prometheus
    type: prometheus
    access: proxy
    url: http://prometheus:9090
    isDefault: true
    editable: true
    jsonData:
      timeInterval: "5s"
      queryTimeout: "60s"
      httpMethod: "POST"
      customQueryParameters: ""
      prometheusType: "Prometheus"
      prometheusVersion: "2.40.0"
      cacheLevel: "High"
      disableMetricsLookup: false
      incrementalQuerying: false
      incrementalQueryOverlapWindow: "10m"
      exemplarTraceIdDestinations:
        - name: "trace_id"
          datasourceUid: "jaeger"
    secureJsonData:
      basicAuthPassword: ""

  # Loki日志数据源
  - name: Loki
    type: loki
    access: proxy
    url: http://loki:3100
    editable: true
    jsonData:
      maxLines: 1000
      timeout: "60s"
      derivedFields:
        - name: "TraceID"
          matcherRegex: "trace_id=(\\w+)"
          url: "http://jaeger:16686/trace/$${__value.raw}"
          datasourceUid: "jaeger"

  # Jaeger链路追踪
  - name: Jaeger
    type: jaeger
    access: proxy
    url: http://jaeger:16686
    editable: true
    uid: "jaeger"

  # InfluxDB时序数据库
  - name: InfluxDB
    type: influxdb
    access: proxy
    url: http://influxdb:8086
    database: "pokeriq_metrics"
    user: "admin"
    editable: true
    jsonData:
      timeInterval: "5s"
      httpMode: "GET"

# 服务器配置
server:
  protocol: http
  http_addr: 0.0.0.0
  http_port: 3000
  domain: grafana.pokeriq.local
  root_url: "%(protocol)s://%(domain)s:%(http_port)s/"
  router_logging: false
  static_root_path: public
  enable_gzip: true
  cert_file: ""
  cert_key: ""
  socket: /tmp/grafana.sock
  cdn_url: ""
  read_timeout: 0

# 数据库配置
database:
  type: postgres
  host: postgres:5432
  name: grafana
  user: grafana
  password: grafana_password
  ssl_mode: disable
  ca_cert_path: ""
  client_cert_path: ""
  client_key_path: ""
  server_cert_name: ""
  path: grafana.db
  max_idle_conn: 2
  max_open_conn: 0
  conn_max_lifetime: 14400
  log_queries: false
  cache_mode: private

# 用户认证配置
auth:
  disable_login_form: false
  disable_signout_menu: false
  signout_redirect_url: ""
  oauth_auto_login: false
  oauth_state_cookie_max_age: 600
  api_key_max_seconds_to_live: -1

# 匿名访问配置
auth.anonymous:
  enabled: true
  org_name: "PokerIQ Pro"
  org_role: Viewer
  hide_version: false

# 基本认证配置
auth.basic:
  enabled: true

# 会话配置
session:
  provider: redis
  provider_config: "addr=redis:6379,pool_size=100,db=0"
  cookie_name: grafana_sess
  cookie_secure: false
  session_life_time: 86400
  gc_interval_time: 86400
  conn_max_lifetime: 14400

# 安全配置
security:
  admin_user: admin
  admin_password: admin_password
  secret_key: SW2YcwTIb9zpOOhoPsMm
  disable_gravatar: false
  data_source_proxy_whitelist: ""
  disable_brute_force_login_protection: false
  cookie_secure: false
  cookie_samesite: lax
  allow_embedding: true
  strict_transport_security: false
  strict_transport_security_max_age_seconds: 86400
  strict_transport_security_preload: false
  strict_transport_security_subdomains: false
  x_content_type_options: true
  x_xss_protection: true
  content_security_policy: false
  content_security_policy_template: ""

# 快照配置
snapshots:
  external_enabled: true
  external_snapshot_url: https://snapshots-origin.raintank.io
  external_snapshot_name: Publish to snapshot.raintank.io
  public_mode: false
  snapshot_remove_expired: true

# 用户配置
users:
  allow_sign_up: true
  allow_org_create: true
  auto_assign_org: true
  auto_assign_org_id: 1
  auto_assign_org_role: Editor
  verify_email_enabled: false
  login_hint: email or username
  password_hint: password
  default_theme: dark
  home_page: ""
  external_manage_link_url: ""
  external_manage_link_name: ""
  external_manage_info: ""
  viewers_can_edit: true
  editors_can_admin: false
  user_invite_max_lifetime_duration: 24h
  hidden_users: ""

# 性能配置
performance:
  # 查询缓存配置
  cache:
    enabled: true
    ttl: "1m"
    max_size_mb: 100

  # 连接池配置
  database_connection_pool:
    max_idle_connections: 2
    max_open_connections: 0
    connection_max_lifetime: 14400

# 插件配置
plugins:
  enable_alpha: false
  app_tls_skip_verify_insecure: false
  allow_loading_unsigned_plugins: ""
  marketplace_url: https://grafana.com/grafana/plugins/

# 告警配置
alerting:
  enabled: true
  execute_alerts: true
  error_or_timeout: alerting
  nodata_or_nullvalues: no_data
  concurrent_render_limit: 5
  evaluation_timeout_seconds: 30
  notification_timeout_seconds: 30
  max_attempts: 3
  min_interval_seconds: 1
  max_annotation_age: ""

# 指标配置
metrics:
  enabled: true
  interval_seconds: 10
  disable_total_stats: false
  basic_auth_username: ""
  basic_auth_password: ""

# 日志配置
log:
  mode: console file
  level: info
  filters: ""

[log.console]
  level: info
  format: console

[log.file]
  level: info
  format: text
  log_rotate: true
  max_lines: 1000000
  max_size_shift: 28
  daily_rotate: true
  max_days: 7

# 外部图片存储配置
external_image_storage:
  provider: local

[external_image_storage.local]
  path: data/png

# 企业功能配置
enterprise:
  license_path: ""

# 功能开关
feature_toggles:
  enable: "publicDashboards,lokiExperimentalStreaming,accesscontrol"

# 面板配置
panels:
  enable_alpha: false
  disable_sanitize_html: false

# 实时配置
live:
  allowed_origins: "*"
  ha_engine: ""
  ha_engine_address: "127.0.0.1:6379"
  ha_engine_password: ""

# 统一告警配置
unified_alerting:
  enabled: true
  disabled_orgs: ""
  admin_config_poll_interval: "60s"
  alertmanager_config_poll_interval: "60s"
  ha_listen_address: "0.0.0.0:9094"
  ha_advertise_address: ""
  ha_peers: ""
  ha_peer_timeout: "15s"
  ha_gossip_interval: "200ms"
  ha_push_pull_interval: "60s"
  ha_redis_address: "redis:6379"
  execute_alerts: true
  evaluation_timeout: "30s"
  max_attempts: 3
  min_interval: "10s"